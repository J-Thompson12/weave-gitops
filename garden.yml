kind: Module
type: exec
local: true
name: generate-garden-development
include: ["manifests/wego-app/deployment.yaml"]
build:
  command: [ ./tools/generate-garden-development.sh ]
---
kind: Module
description: Wego image
name: wego-app-image
type: container
dockerfile: dev.dockerfile
include: [cmd, pkg, manifests, api, dev.dockerfile, go.mod, go.sum, main.go, .air.toml]
exclude: [node_modules]
---
kind: Module
description: Wego k8s
name: wego-app-service
type: kubernetes
build:
  dependencies:
    - name: generate-garden-development
    - name: wego-app-image
include: [cmd, pkg, manifests, api, go.mod, go.sum, main.go, .air.toml, .garden-deployment.yaml ]
exclude: [node_modules]
devMode:
  command: [ ./bin/air ]
  args: [ -d ]
  sync:
    - target: /go/src/github.com/weaveworks/weave-gitops/cmd
      source: cmd
    - target: /go/src/github.com/weaveworks/weave-gitops/pkg
      source: pkg
    - target: /go/src/github.com/weaveworks/weave-gitops/api
      source: api
    - target: /go/src/github.com/weaveworks/weave-gitops/manifests
      source: manifests
    - target: /go/src/github.com/weaveworks/weave-gitops/
      source: go.mod
    - target: /go/src/github.com/weaveworks/weave-gitops/
      source: go.sum
    - target: /go/src/github.com/weaveworks/weave-gitops/
      source: main.go
namespace: wego-system
serviceResource:
  kind: Deployment
  containerModule: wego-app-image
  name: wego-app # This need to match the name of the deployment
  containerName: wego-app
  hotReloadArgs: [./bin/air]
files: [
    .garden-deployment.yaml,
    manifests/wego-app/service.yaml,
    manifests/wego-app/role.yaml,
    manifests/wego-app/role-binding.yaml,
    manifests/wego-app/service.yaml,
    manifests/wego-app/service-account.yaml,
    manifests/garden-io/ingress.yaml,
]